<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creatorflow - Tasks</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        ugc: {
                            bg: { DEFAULT: '#ffffff', dark: '#141414' },
                            sidebar: { DEFAULT: '#ffffff', dark: '#0F0F0F' },
                            card: { DEFAULT: '#ffffff', dark: '#1E1E1E' },
                            pink: '#E65696',
                            purple: '#9D66E3',
                            text: { DEFAULT: '#000000', dark: '#EAEAEA' },
                            muted: { DEFAULT: '#9ca3af', dark: '#A0A0A0' },
                            border: { DEFAULT: '#e5e7eb', dark: '#2A2A2A' },
                            hover: { DEFAULT: '#f3f4f6', dark: '#252525' }
                        }
                    },
                    transitionProperty: {
                        'width': 'width'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: var(--tw-bg-ugc-bg); color: var(--tw-text-ugc-text); }
    
        .text-gradient {
            background: linear-gradient(90deg, #E65696 0%, #9D66E3 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--tw-bg-ugc-bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        body, html {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        :not(.dark) body {
            filter: brightness(1.05);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(230, 86, 150, 0.15) 0%, rgba(157, 102, 227, 0.05) 100%);
            border-left: 3px solid #E65696;
            color: #E65696;
        }

        /* Sidebar Collapsed Styles */
        .sidebar-collapsed .sidebar-text { display: none; opacity: 0; }
        .sidebar-collapsed .nav-item { justify-content: center; padding-left: 0; padding-right: 0; }
        .sidebar-collapsed .nav-item i { margin-right: 0; }
        .sidebar-collapsed .logo-text { display: none; }
        .sidebar-collapsed .section-label { display: none; }
        .sidebar-collapsed .user-info { display: none; }
        .sidebar-collapsed .nav-badge { position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; padding: 0; border-radius: 50%; text-indent: -9999px; background-color: #E65696; }

        /* Anima√ß√µes */
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast { animation: slideIn 0.3s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Sidebar mobile transition */
        .sidebar-mobile { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        .sidebar-mobile.open { transform: translateX(0); }
        </style>
    </head>
    <body class="bg-ugc-bg text-ugc-text flex h-screen overflow-hidden text-sm relative">

        <!-- Overlay para Mobile -->
        <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden glass" onclick="toggleMobileMenu()"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-ugc-sidebar border-r border-ugc-border flex flex-col sidebar-mobile md:translate-x-0 md:static transition-all duration-300 ease-in-out group/sidebar">
            <!-- Logo Area & Toggle -->
            <div class="h-20 flex items-center justify-between px-6 border-b border-ugc-border/50 relative">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-ugc-pink to-ugc-purple flex items-center justify-center shrink-0 shadow-lg shadow-ugc-pink/20">
                        <i data-lucide="sparkles" class="text-white w-5 h-5"></i>
                    </div>
                    <span class="font-display font-bold text-lg tracking-wide ml-3 logo-text whitespace-nowrap overflow-hidden transition-all duration-300">Creatorflow</span>
                </div>
            
                <button onclick="toggleSidebarDesktop()" class="hidden md:flex absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-ugc-card border border-ugc-border rounded-full items-center justify-center text-ugc-muted hover:text-white hover:border-ugc-pink transition-colors z-50">
                    <i id="sidebar-toggle-icon" data-lucide="chevron-left" class="w-3 h-3 transition-transform duration-300"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 py-6 px-3 space-y-1 overflow-y-auto overflow-x-hidden">
                <p class="section-label px-3 text-[10px] font-bold text-ugc-muted uppercase tracking-wider mb-2 mt-2 truncate">Principal</p>
            
                <a href="creatorflow.html" class="nav-item w-full flex items-center px-3 py-2.5 rounded-lg text-ugc-muted hover:text-ugc-text hover:bg-ugc-hover transition-colors group relative" title="Dashboard">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 group-hover:text-ugc-pink transition-colors shrink-0"></i>
                    <span class="font-medium sidebar-text whitespace-nowrap overflow-hidden transition-all">Dashboard</span>
                </a>

                <a href="contracts.html" class="nav-item w-full flex items-center px-3 py-2.5 rounded-lg text-ugc-muted hover:text-ugc-text hover:bg-ugc-hover transition-colors group relative" title="Contratos">
                    <i data-lucide="file-signature" class="w-5 h-5 mr-3 group-hover:text-ugc-pink transition-colors shrink-0"></i>
                    <span class="font-medium sidebar-text whitespace-nowrap overflow-hidden transition-all">Contratos</span>
                </a>
                <a href="finance.html" class="nav-item w-full flex items-center px-3 py-2.5 rounded-lg text-ugc-muted hover:text-ugc-text hover:bg-ugc-hover transition-colors group relative" title="Financeiro">
                    <i data-lucide="dollar-sign" class="w-5 h-5 mr-3 group-hover:text-ugc-pink transition-colors shrink-0"></i>
                    <span class="font-medium sidebar-text whitespace-nowrap overflow-hidden transition-all">Financeiro</span>
                </a>
                <a href="pricing_simulator.html" class="nav-item w-full flex items-center px-3 py-2.5 rounded-lg text-ugc-muted hover:text-ugc-text hover:bg-ugc-hover transition-colors group relative" title="Simulador de Pre√ßo">
                    <i data-lucide="calculator" class="w-5 h-5 mr-3 group-hover:text-ugc-pink transition-colors shrink-0"></i>
                    <span class="font-medium sidebar-text whitespace-nowrap overflow-hidden transition-all">Simulador de Pre√ßo</span>
                </a>

                </div>

                <!-- Coluna 2: Em Produ√ß√£o (doing) -->
                <div class="kanban-col flex flex-col w-80 h-full"
                     ondragover="allowDrop(event)" 
                     ondrop="drop(event, 'doing')"
                     ondragenter="dragEnter(event)" 
                     ondragleave="dragLeave(event)">
                    <div class="flex items-center justify-between mb-4 px-1">
                        <div class="flex items-center gap-2">
                            <span class="w-2.5 h-2.5 rounded-full bg-blue-500"></span>
                            <h3 class="font-bold text-ugc-text text-sm uppercase tracking-wide">Em Produ√ß√£o</h3>
                            <span id="count-doing" class="text-xs text-ugc-muted bg-ugc-card px-1.5 py-0.5 rounded border border-ugc-border">0</span>
                        </div>
                    </div>
                    <div id="col-doing" class="flex-1 bg-ugc-bg/50 rounded-xl flex flex-col gap-3 overflow-y-auto pr-2 pb-10 min-h-[100px] transition-colors p-2">
                        <!-- Cards injetados via JS -->
                    </div>
                </div>

                <!-- Coluna 3: Aprova√ß√£o (review) -->
                <div class="kanban-col flex flex-col w-80 h-full"
                     ondragover="allowDrop(event)" 
                     ondrop="drop(event, 'review')"
                     ondragenter="dragEnter(event)" 
                     ondragleave="dragLeave(event)">
                    <div class="flex items-center justify-between mb-4 px-1">
                        <div class="flex items-center gap-2">
                            <span class="w-2.5 h-2.5 rounded-full bg-yellow-500"></span>
                            <h3 class="font-bold text-ugc-text text-sm uppercase tracking-wide">Aprova√ß√£o</h3>
                            <span id="count-review" class="text-xs text-ugc-muted bg-ugc-card px-1.5 py-0.5 rounded border border-ugc-border">0</span>
                        </div>
                    </div>
                    <div id="col-review" class="flex-1 bg-ugc-bg/50 rounded-xl flex flex-col gap-3 overflow-y-auto pr-2 pb-10 min-h-[100px] transition-colors p-2">
                        <!-- Cards injetados via JS -->
                    </div>
                </div>

                <!-- Coluna 4: Finalizado (done) -->
                <div class="kanban-col flex flex-col w-80 h-full"
                     ondragover="allowDrop(event)" 
                     ondrop="drop(event, 'done')"
                     ondragenter="dragEnter(event)" 
                     ondragleave="dragLeave(event)">
                    <div class="flex items-center justify-between mb-4 px-1">
                        <div class="flex items-center gap-2">
                            <span class="w-2.5 h-2.5 rounded-full bg-green-500"></span>
                            <h3 class="font-bold text-ugc-text text-sm uppercase tracking-wide">Finalizado</h3>
                            <span id="count-done" class="text-xs text-ugc-muted bg-ugc-card px-1.5 py-0.5 rounded border border-ugc-border">0</span>
                        </div>
                    </div>
                    <div id="col-done" class="flex-1 bg-ugc-bg/50 rounded-xl flex flex-col gap-3 overflow-y-auto pr-2 pb-10 min-h-[100px] transition-colors p-2">
                        <!-- Cards injetados via JS -->
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- Modal Novo Task -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div id="modal-content" class="bg-ugc-card w-full max-w-md mx-4 rounded-2xl border border-ugc-border shadow-2xl transform scale-95 transition-transform duration-300 p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Novo Task</h3>
                <button onclick="closeModal()" class="text-ugc-muted hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <form id="new-task-form" onsubmit="handleNewTask(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-medium text-ugc-muted mb-1.5">Marca / Cliente</label>
                    <input type="text" id="job-brand" required placeholder="Ex: La Roche Posay" class="w-full bg-ugc-bg border border-ugc-border rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-ugc-pink focus:ring-1 focus:ring-ugc-pink transition-all">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-ugc-muted mb-1.5">Tipo</label>
                        <select id="job-type" class="w-full bg-ugc-bg border border-ugc-border rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-ugc-pink transition-all">
                            <option value="Reels">Reels</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Stories">Stories</option>
                            <option value="Combo">Combo</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-ugc-muted mb-1.5">Valor (R$)</label>
                        <input type="number" id="job-value" required placeholder="0,00" class="w-full bg-ugc-bg border border-ugc-border rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-ugc-pink transition-all">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-medium text-ugc-muted mb-1.5">Prazo de Entrega</label>
                    <input type="date" id="job-date" required class="w-full bg-ugc-bg border border-ugc-border rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-ugc-pink transition-all [color-scheme:dark]">
                </div>

                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal()" class="flex-1 bg-transparent border border-ugc-border text-white py-2.5 rounded-lg hover:bg-ugc-hover transition-colors">Cancelar</button>
                    <button type="submit" class="flex-1 bg-ugc-pink hover:bg-pink-600 text-white font-bold py-2.5 rounded-lg shadow-lg shadow-ugc-pink/20 transition-all transform active:scale-95">Salvar Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3 pointer-events-none"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, onSnapshot, doc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- CONFIGURA√á√ÉO DO FIREBASE (Sua Configura√ß√£o) ---
        const firebaseConfig = {
          apiKey: "AIzaSyAP4fQ3TZ09XWggKNKZJDMJQ8TnRdNYwzc",
          authDomain: "ugcp-9ec19.firebaseapp.com",
          projectId: "ugcp-9ec19",
          storageBucket: "ugcp-9ec19.firebasestorage.app",
          messagingSenderId: "921864203168",
          appId: "1:921864203168:web:55fb378c2a904737d512c5",
          measurementId: "G-51WXW579CN"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'creatorflow-app'; // ID consistente entre p√°ginas
        let userId = null;
        let isSidebarCollapsed = false;

        async function initAuth() {
            try {
                onAuthStateChanged(auth, async (user) => {
                    if (!user || user.isAnonymous) {
                        try { if (user && user.isAnonymous) await signOut(auth); } catch(e){}
                        window.location.href = './index.html';
                        return;
                    }
                    userId = user.uid;
                    setupRealtimeListener();
                });
            } catch (error) {
                console.error("Erro ao inicializar autentica√ß√£o:", error);
            }
        }

        function setupRealtimeListener() {
            if (!userId) return;
            // Mesmo caminho que o dashboard e planner
            const jobsCollection = collection(db, 'artifacts', appId, 'users', userId, 'tasks');
            
            onSnapshot(jobsCollection, (snapshot) => {
                const jobs = [];
                snapshot.forEach((doc) => {
                    jobs.push({ id: doc.id, ...doc.data() });
                });
                
                // Ordenar localmente
                jobs.sort((a, b) => {
                    const dateA = a.createdAt?.seconds || 0;
                    const dateB = b.createdAt?.seconds || 0;
                    return dateB - dateA;
                });
                
                renderBoard(jobs);
            }, (error) => {
                console.error("Erro ao buscar dados:", error);
            });
        }

        // -- Renderiza√ß√£o do Kanban --
        function renderBoard(jobs) {
            const cols = { todo: [], doing: [], review: [], done: [] };
            
            // Agrupar jobs por status
            jobs.forEach(job => {
                const status = job.status || 'todo';
                if (cols[status]) cols[status].push(job);
            });

            for (const [status, items] of Object.entries(cols)) {
                const container = document.getElementById(`col-${status}`);
                const counter = document.getElementById(`count-${status}`);
                
                if(counter) counter.innerText = items.length;
                if(container) {
                    container.innerHTML = '';
                    items.forEach(job => {
                        const card = document.createElement('div');
                        card.className = 'kanban-card bg-ugc-card p-4 rounded-xl border border-ugc-border hover:border-ugc-pink/50 group relative';
                        card.draggable = true;
                        
                        // Eventos de Drag & Drop
                        card.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData("jobId", job.id);
                            e.dataTransfer.effectAllowed = "move";
                        });

                        // Cores das tags
                        let tagColor = 'bg-gray-500/10 text-gray-400 border-gray-500/20';
                        if (job.type === 'TikTok') tagColor = 'bg-purple-500/10 text-purple-400 border-purple-500/20';
                        if (job.type === 'Reels') tagColor = 'bg-blue-500/10 text-blue-400 border-blue-500/20';
                        if (job.type === 'Stories') tagColor = 'bg-orange-500/10 text-orange-400 border-orange-500/20';

                        // Formatar data (YYYY-MM-DD -> DD/MM)
                        let dateStr = '--/--';
                        if (job.date) {
                            const [y, m, d] = job.date.split('-');
                            dateStr = `${d}/${m}`;
                        }

                        // Bot√£o de deletar
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = "text-ugc-muted hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute top-4 right-4";
                        deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>';
                        deleteBtn.onclick = () => deleteJob(job.id);

                        card.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <span class="${tagColor} text-[10px] font-bold px-2 py-0.5 rounded border uppercase">${job.type}</span>
                            </div>
                            <h4 class="text-white font-bold mb-1">${job.brand}</h4>
                            <p class="text-ugc-muted text-xs mb-3">Entrega prevista para ${dateStr}</p>
                            <div class="flex items-center justify-between text-xs text-ugc-muted border-t border-ugc-border/50 pt-3">
                                <span class="flex items-center gap-1">üìÖ ${dateStr}</span>
                                <span class="text-white font-medium">R$ ${job.value}</span>
                            </div>
                        `;
                        card.appendChild(deleteBtn);
                        container.appendChild(card);
                    });
                }
            }
            lucide.createIcons();
        }

        // -- CRUD FIREBASE --
        window.handleNewTask = async function(e) {
            e.preventDefault();
            if (!userId) return;

            const brand = document.getElementById('job-brand').value;
            const type = document.getElementById('job-type').value;
            const value = document.getElementById('job-value').value;
            const date = document.getElementById('job-date').value;

            try {
                await addDoc(collection(db, 'artifacts', appId, 'users', userId, 'tasks'), {
                    brand, type, value, date, status: 'todo', createdAt: new Date()
                });
                closeModal();
                showToast('Nova task salva!');
            } catch (error) {
                console.error("Erro ao salvar:", error);
                showToast("Erro ao salvar task.");
            }
        }

        async function deleteJob(id) {
            if(confirm('Tem certeza que deseja excluir esta task?')) {
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', userId, 'tasks', id));
                    showToast('Task exclu√≠do.');
                } catch (error) {
                    console.error("Erro ao deletar:", error);
                }
            }
        }

        // -- Drag and Drop Logic --
        window.allowDrop = (ev) => ev.preventDefault();
        
        window.dragEnter = (ev) => {
            ev.preventDefault();
            const col = ev.target.closest('.kanban-col');
            if (col) {
                const container = col.querySelector('[id^="col-"]');
                if(container) container.classList.add('bg-ugc-hover');
            }
        }

        window.dragLeave = (ev) => {
            const col = ev.target.closest('.kanban-col');
            if (col) {
                const container = col.querySelector('[id^="col-"]');
                if(container) container.classList.remove('bg-ugc-hover');
            }
        }

        window.drop = async (ev, newStatus) => {
            ev.preventDefault();
            const col = ev.target.closest('.kanban-col');
            if (col) {
                const container = col.querySelector('[id^="col-"]');
                if(container) container.classList.remove('bg-ugc-hover');
            }

            const jobId = ev.dataTransfer.getData("jobId");
            if (jobId && userId) {
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'users', userId, 'tasks', jobId), {
                        status: newStatus
                    });
                    showToast(`Job movido para ${newStatus.toUpperCase()}`);
                } catch (error) {
                    console.error("Erro ao mover:", error);
                }
            }
        }

        // -- UI Helpers --
        window.toggleSidebarDesktop = () => {
            const s=document.getElementById('sidebar'), i=document.getElementById('sidebar-toggle-icon'); 
            isSidebarCollapsed=!isSidebarCollapsed; 
            if(isSidebarCollapsed){s.classList.add('w-20','sidebar-collapsed');s.classList.remove('w-64');i.style.transform='rotate(180deg)'}
            else{s.classList.remove('w-20','sidebar-collapsed');s.classList.add('w-64');i.style.transform='rotate(0deg)'}
        }
        window.toggleMobileMenu = () => { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('mobile-overlay').classList.toggle('hidden'); }
        window.openModal = () => {
            const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'); 
            o.classList.remove('hidden'); 
            setTimeout(()=>{o.classList.remove('opacity-0');c.classList.remove('scale-95');c.classList.add('scale-100');},10);
            const today = new Date();
            // Pega data local YYYY-MM-DD
            const localDate = today.toLocaleDateString('en-CA');
            document.getElementById('job-date').value = localDate;
        }
        window.closeModal = () => { 
            const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'); 
            o.classList.add('opacity-0'); c.classList.remove('scale-100'); c.classList.add('scale-95'); 
            setTimeout(()=>{o.classList.add('hidden');document.getElementById('new-job-form').reset();},300); 
        }
        window.showToast = (m) => {
            const c=document.getElementById('toast-container'), t=document.createElement('div');
            t.className='toast bg-ugc-card border border-ugc-pink/30 text-white px-4 py-3 rounded-lg shadow-xl flex gap-3 min-w-[300px] pointer-events-auto';
            t.innerHTML=`<div class="bg-ugc-pink/20 p-1.5 rounded-full text-ugc-pink"><i data-lucide="check" class="w-4 h-4"></i></div><span class="text-sm font-medium">${m}</span>`;
            c.appendChild(t); lucide.createIcons();
            setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(20px)';setTimeout(()=>t.remove(),300)},3000);
        }

        // Theme toggle
        window.toggleTheme = () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            updateThemeIcon();
        };

        // Update theme icon
        function updateThemeIcon() {
            const themeIcon = document.querySelector('#theme-toggle-icon');
            if (themeIcon) {
                themeIcon.setAttribute('data-lucide', document.documentElement.classList.contains('dark') ? 'sun' : 'moon');
                lucide.createIcons();
            }
        }

        // Load theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }
        updateThemeIcon();

        // auth state listener above handles initialization
        lucide.createIcons();
    </script>
</body>
</html>
